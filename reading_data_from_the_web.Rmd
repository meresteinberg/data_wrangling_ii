---
title: "Reading Data from the Web"
output: github_document
date: "2024-10-11"
---

```{r setup, include=FALSE}
library(tidyverse)
library(rvest)
library(httr)
```

```{r}
url = "http://samhda.s3-us-gov-west-1.amazonaws.com/s3fs-public/field-uploads/2k15StateFiles/NSDUHsaeShortTermCHG2015.htm"
drug_use_html = read_html(url)

drug_use_html
```

Get the pieces I actually need 
--adding first() gives us just the first table
```{r}
marj_use_df=
drug_use_html |> 
  html_table() |> 
  first() |> 
  slice(-1)
```

Learning Assessment
--header=TRUE says first row is the header
```{r}
url= "https://www.bestplaces.net/cost_of_living/city/new_york/new_york"

cost_html=read_html(url)

cost_html |> 
  html_table(header= TRUE) |> 
  first()
```
OR 
```{r}
nyc_cost = 
  read_html("https://www.bestplaces.net/cost_of_living/city/new_york/new_york") |>
  html_table(header = TRUE) |>
  first()
```

## CSS Selectors 

```{r}
swm_html = 
  read_html("https://www.imdb.com/list/ls070150896/") 

title_vec=
  swm_html |> 
  html_elements(".ipc-title-link-wrapper .ipc-title__text") |> 
  html_text()

runtime_vec=  
  swm_html |> 
  html_elements(".dli-title-metadata-item:nth-child(2)") |> 
  html_text()

swm_df=
  tibble(
    title= title_vec,
    runtime= runtime_vec
  )
```
Steps: click selector gatchet bookmark, click what you want and can then click on what you dont want, and can then copy the CSS tag at the bottom that is pasted into html_elements()



Lets import some books
```{r}
books_html=read_html("https://books.toscrape.com/")

books_html |> 
  html_elements(".product_pod a") |> 
  html_text()
```

## Using an API

Get water data.

```{r}
nyc_water = 
  GET("https://data.cityofnewyork.us/resource/ia2d-e54m.csv") |> 
  content("parsed")
```

Get BRFSS data--limit parameter is based on instructions from this website
```{r}
brfss_smart2010 = 
  GET("https://chronicdata.cdc.gov/resource/acme-vg9e.csv",
      query = list("$limit" = 5000)) |> 
  content("parsed")
```

Pokemon API
```{r}
poke = 
  GET("http://pokeapi.co/api/v2/pokemon/ditto") |>
  content()

poke[["name"]]
```



