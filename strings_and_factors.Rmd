---
title: "strings_and_factors"
output: github_document
date: "2024-10-16"
---
Load necessary libraries
```{r setup, include=FALSE}
library(rvest)
library(tidyverse)
library(p8105.datasets)

```

## Let's do strings

```{r}
string_vec=c("my", "name", "is", "jess")

str_detect(string_vec, "a")

str_detect(string_vec, "Jess")

str_replace(string_vec, "jess", "Jeff")

str_replace(string_vec, "e", "E")
```
str_detect will tell us which ones has an "a" in it; it is case sensitive and capitalized J will not be recognized. str_replace can capitalize things

```{r}
string_vec = c(
  "i think we all rule for participating",
  "i think i have been caught",
  "i think this will be quite fun actually",
  "it will be fun, i think"
  )
str_detect(string_vec, "i think")

str_detect(string_vec, "^i think")

str_detect(string_vec, "i think^")
```
if want to find one that STARTS with "i think", put carrot in front (and vice versa)

```{r}
string_vec = c(
  "Time for a Pumpkin Spice Latte!",
  "went to the #pumpkinpatch last weekend",
  "Pumpkin Pie is obviously the best pie",
  "SMASHING PUMPKINS -- LIVE IN CONCERT!!"
  )

str_detect(string_vec, "pumpkin")

str_detect(string_vec, "Pumpkin")

str_detect(string_vec,"[Pp]umpkin")
```


```{r}
string_vec = c(
  '7th inning stretch',
  '1st half soon to begin. Texas won the toss.',
  'she is 5 feet 4 inches tall',
  '3AM - cant sleep :('
  )

str_detect(string_vec,"[0-9][a-z]")

str_detect(string_vec, "^[0-9][a-zA-Z]")
```
pattern of number and then two letters. str_detect not detecting third one bc number followed by a space


```{r}
string_vec = c(
  'Its 7:11 in the evening',
  'want to go to 7-11?',
  'my flight is AA711',
  'NetBios: scanning ip 203.167.114.66'
  )

str_detect(string_vec, "7.11")
```
want "7 any character 11". Dot is special bc matches anything


How things start to get real strange
```{r}
string_vec = c(
  'The CI is [2, 5]',
  ':-]',
  ':-[',
  'I found the answer on pages [6-7]'
  )

str_detect(string_vec, "\\[")
```
What if we are looking for a special character like a bracket? \\tells that we are looking for bracket

##Factors...

```{r}
sex_vec= factor(c("male", "male", "female", "female"))
as.numeric(sex_vec)
```
easy to mistake categorical variables/factor variables for string variables, but factors give us a little more info



do some releveling...
```{r}
sex_vec=fct_relevel(sex_vec, "male")

as.numeric(sex_vec)
```
first putting male male first


## Revisit a lot of exampples

NSDUH

```{r}
url = "http://samhda.s3-us-gov-west-1.amazonaws.com/s3fs-public/field-uploads/2k15StateFiles/NSDUHsaeShortTermCHG2015.htm"
drug_use_html = read_html(url)

drug_use_html
```

Get pieces actually need
```{r}
marj_use_df=
drug_use_html |> 
  html_table() |> 
  first() |> 
  slice(-1) |> 
  select(-contains("P Value")) |> 
  pivot_longer(
    cols= -State,
    names_to = "age_year",
    values_to = "percent"
  ) |> 
  separate(age_year, into = c("age", "year"), sep = "\\(") |> 
  mutate(
    year=str_replace(year, "\\)", ""),
    percent=str_remove(percent, "[a-c]$"),
    percent=as.numeric(percent)
  )
```
after slice: get rid of p values, go from wide format to long format, separate columns into two variables (age grp and year), also get rid of a's and b's and c's in the percentages and convert all numbers to numeric variables.


Want plot of proportion of kids who responded YES in 2013, 2014, 2015 only among kids 12-17
```{r}
marj_use_df |> 
  filter(age== "12-17") |> 
  mutate(
    State=fct_reorder(State, percent)
  ) |> 
  ggplot(aes(x=State, y=percent, color=year))+
  geom_point()+
  theme(axis.text.x = element_text(angle=90, vjust = 0.5, hjust = 1))
```
fct_reorder statement we are saying we have this categorical variable (State) and want to order it by percent


## NYC Restaurant Inspections
```{r}
data("rest_inspec")

rest_inspec |> 
  slice(1:1000)
```

```{r}
rest_inspec |> 
  count(boro, grade) |> 
  pivot_wider(
    names_from = grade,
    values_from = n
  )
```

only going to look at ABC grades and get rid of missing boro info (putting ! infront of function will do opposite )
```{r}
rest_inspec=
  rest_inspec |> 
  filter(
    str_detect(grade, "[A-C]"),
    !(boro== "Missing")
  )
```

```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza"))
```


```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza")) |> 
  mutate(boro=fct_infreq(boro)) |> 
  ggplot(aes(x=boro))+
  geom_bar()
```
fct_infreq tells to put boros in order of frequency


```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza")) |> 
  mutate(boro=fct_relevel(boro, "STATEN ISLAND")) |> 
  ggplot(aes(x=boro))+
  geom_bar()
```
putting staten island first with relevel


```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza")) |> 
  mutate(boro=str_replace(boro, "MANHATTAN", "THE CITY"),
         boro=fct_infreq(boro)
         ) |> 
  ggplot(aes(x=boro))+
  geom_bar()
```


```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza")) |> 
  mutate(boro=fct_infreq(boro),
         boro=fct_recode(boro, "THE CITY"= "MANHATTAN")
         ) |> 
  ggplot(aes(x=boro))+
  geom_bar()
```
fct_recode does same thing as str_replace for changing Manhattan to The City


One last thing on factors...

```{r}
rest_inspec |> 
  mutate(dba=str_to_sentence(dba)) |> 
  filter(str_detect(dba, "Pizza")) |> 
  mutate(boro=fct_infreq(boro)) |> 
  lm(zipcode~boro, data= _)
```




